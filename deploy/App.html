<!DOCTYPE html>
<html>
<head>
    <title>ProjectBurnChart</title>

    <script type="text/javascript" src="/apps/2.0rc1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("ActualCalculator",{extend:"Rally.data.lookback.calculator.BaseCalculator",runCalculation:function(snapshots){return{series:[{name:"Dummy series",data:[1,2,3]}],categories:Ext.Array.each(this.iterations,function(record){return record.get("Name")+"<br/>"+record.get("EndDate")})}}});
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",layout:"fit",launch:function(){this.setLoading(!0);var projectRef=this.getContext().getProjectRef();this.loadIterations(projectRef)},loadIterations:function(projectRef){var app=this,iterationStore=Ext.create("Rally.data.WsapiDataStore",{model:"Iteration",context:{project:projectRef,projectScopeUp:!1,projectScopeDown:!1},filters:[{property:"Project",value:projectRef}],sorters:[{property:"StartDate",direction:"ASC"}]}),iterationsPromise=iterationStore.load();iterationsPromise.then({success:function(records){app.loadChart(records),this.setLoading(!1)},failure:function(error){console.log("Failed to load iterations for project '"+projectRef+"'"),console.log(error)}})},loadChart:function(iterations){var chart=this.getChart(iterations);this.add(chart)},getChart:function(iterations){return{xtype:"rallychart",storeType:"Rally.data.lookback.SnapshotStore",storeConfig:{find:{_TypeHierarchy:"HierarchicalRequirement",ScheduleState:"Accepted",Children:null},fetch:["PlanEstimate"]},calculatorType:"ActualCalculator",calculatorConfig:{iterations:iterations},chartConfig:{chart:{type:"column"},title:{text:"Stacked column chart"},xAxis:{categories:["Apples","Oranges","Pears","Grapes","Bananas"]},yAxis:{min:0,title:{text:"Total fruit consumption"}},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"<br/>"+"Total: "+this.point.stackTotal}},plotOptions:{column:{stacking:"normal"}}}}}});

            Rally.launchApp('CustomApp', {
                name:"ProjectBurnChart",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
